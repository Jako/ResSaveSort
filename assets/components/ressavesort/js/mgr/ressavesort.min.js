/*!
 * ResSaveSort - Sort MODX containers after saving resources.
 * Version: 1.1.1
 * Build date: 2024-01-18
 */
var resSaveSort=function(e){resSaveSort.superclass.constructor.call(this,e=e||{})};Ext.extend(resSaveSort,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},jquery:{},form:{}}),Ext.reg("ressavesort",resSaveSort),(ResSaveSort=new resSaveSort).grid.Systemsetting=function(e){e=e||{},this.ident="ressavesort-systemsetting-"+Ext.id(),this.buttonColumnTpl=new Ext.XTemplate('<tpl for="."><tpl if="action_buttons !== null"><ul class="action-buttons"><tpl for="action_buttons"><li><i class="icon {className} icon-{icon}" title="{text}"></i></li></tpl></ul></tpl></tpl>',{compiled:!0}),this.hiddenField=new Ext.form.TextArea({name:e.hiddenName||e.name,hidden:!0}),Ext.applyIf(e,{id:this.ident+"-systemsetting-grid",cls:"ressavesort-panel",fields:["id","sortby","sortdir","sortcontainer","rank"],autoHeight:!0,store:new Ext.data.JsonStore({fields:["id","sortby","sortdir","sortcontainer","rank"],data:Ext.util.JSON.decode(e.value)}),enableDragDrop:!0,ddGroup:this.ident+"-systemsetting-grid-dd",autoExpandColumn:"value",showActionsColumn:!1,labelStyle:"position: absolute",columns:[{header:_("ressavesort.sortby"),dataIndex:"sortby",editable:!0,editor:{xtype:"textfield",allowBlank:!1,listeners:{change:{fn:this.saveValue,scope:this}}},width:100},{header:_("ressavesort.sortdir"),dataIndex:"sortdir",editable:!0,editor:{xtype:"textfield",listeners:{change:{fn:this.saveValue,scope:this}}},width:100},{header:_("ressavesort.sortcontainer"),dataIndex:"sortcontainer",editable:!0,editor:{xtype:"textfield",listeners:{change:{fn:this.saveValue,scope:this}}},width:100},{renderer:{fn:this.buttonColumnRenderer,scope:this},menuDisabled:!0,width:30,align:"right"},{dataIndex:"rank",hidden:!0},{dataIndex:"id",hidden:!0}],tbar:["->",{text:'<i class="icon icon-plus"></i> '+_("add"),cls:"primary-button",handler:this.addEntry,scope:this}],listeners:{render:{fn:this.renderListener,scope:this}}}),ResSaveSort.grid.Systemsetting.superclass.constructor.call(this,e)},Ext.extend(ResSaveSort.grid.Systemsetting,MODx.grid.LocalGrid,{windows:{},getMenu:function(){var e=[];return e.push({text:_("remove"),handler:this.removeEntry}),e},addEntry:function(){var e=new(this.getStore().recordType)({targetwidth:"",targetheight:"",targetRatio:""});this.getStore().insert(0,e),this.getView().refresh(),this.getSelectionModel().selectRow(0)},removeEntry:function(){Ext.Msg.confirm(_("remove")||"",_("confirm_remove")||"",function(e){if("yes"===e){var t=this.getStore(),r=this.getSelectionModel().getSelections();if(!r.length)return!1;for(var i=0;i<r.length;i++){r[i].id;var s=t.findBy(function(e,t){if(e.id===t)return!0});t.removeAt(s)}this.getView().refresh(),this.saveValue()}},this)},renderListener:function(a,e,t,r){if(a.container instanceof Ext.Layer)return a.container.addListener("beforestartedit",function(){return!1}),console.log(a),!1;new Ext.dd.DropTarget(a.container,{copy:!1,ddGroup:this.ident+"-systemsetting-grid-dd",notifyDrop:function(e,t,r){var i=a.store,s=a.getSelectionModel(),n=s.getSelections(),e=e.getDragData(t);if(e){t=e.rowIndex;if(void 0!==t){for(var o=0;o<n.length;o++)i.remove(i.getById(n[o].id));i.insert(t,r.selections),s.clearSelections()}}a.getView().refresh(),a.saveValue()}}),this.add(this.hiddenField),this.saveValue()},buttonColumnRenderer:function(){var e={action_buttons:[{className:"remove",icon:"trash-o",text:_("remove")}]};return this.buttonColumnTpl.apply(e)},onClick:function(e){var t,r=e.getTarget();"icon"===r.className.split(" ")[0]&&(r=r.className.split(" ")[1],t=this.getSelectionModel().getSelected(),this.menu.record=t.data,"remove"===r)&&this.removeEntry(t,e)},saveValue:function(){var t=[];Ext.each(this.getStore().getRange(),function(e){t.push({sortby:e.data.sortby,sortdir:e.data.sortdir,sortcontainer:e.data.sortcontainer})}),this.hiddenField.setValue(Ext.util.JSON.encode(t))}}),Ext.reg("ressavesort-systemsetting-grid",ResSaveSort.grid.Systemsetting);